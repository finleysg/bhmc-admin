{
	"permissions": {
		"allow": [
			"Bash(tree *)",
			"Bash(xargs *)",
			"Bash(cat *)",
			"Bash(ls *)",
			"Bash(grep *)",
			"Bash(head *)",
			"Bash(wc *)",
			"Bash(curl *)",
			"Bash(chmod *)",
			"Bash(echo *)",
			"Bash(pnpm *)",
			"Bash(npx *)",
			"Bash(npm *)",
			"Bash(git *)",
			"Bash(gh *)",
			"Bash(docker *)",
			"Bash(docker-compose *)",
			"Bash(uv *)",
			"Bash(CI=true pnpm *)",
			"Bash(bash *)",
			"Skill(commit)",
			"Bash(gh pr create:*)",
			"Bash(gh issue create --title \"Handle 401 errors: redirect to sign-in with returnUrl\" --body \"$\\(cat <<''EOF''\n## Goal\nWhen API returns 401 \"Invalid or expired token\", logout user and redirect to `/sign-in?returnUrl=...`\n\n## Requirements\n- No toast before redirect \\(silent\\)\n- Support returnUrl param for post-auth redirect\n- Minimal scope: create hook + update use-report.ts only\n\n## Files to Create\n\n**`apps/web/lib/fetch-with-auth-check.ts`** \\(new\\)\n- `useAuthFetch\\(\\)` - fetch wrapper that handles 401\n- `useHandle401\\(\\)` - check existing response for 401\n- Both: logout → redirect to `/sign-in?returnUrl={currentPath}`\n\n## Files to Modify\n\n**`apps/web/lib/use-report.ts`**\n- `useAuthenticatedFetch`: add 401 check after fetch\n- `useExcelExport`: add 401 check after fetch\n- Import: `useRouter`, `usePathname` from next/navigation\n- On 401: `await logout\\(\\)` then `router.push\\(\\\\`/sign-in?returnUrl=${pathname}\\\\`\\)`\n\n**`apps/web/app/sign-in/page.tsx`**\n- Read `returnUrl` from `useSearchParams\\(\\)`\n- On success: redirect to `returnUrl || \"/\"`\n- Validate returnUrl starts with \"/\" \\(prevent open redirect\\)\n\n## Verification\n1. `pnpm --filter web dev`\n2. Sign in → navigate to /events/123/players\n3. Clear `access_token` cookie in devtools\n4. Trigger API call → should redirect to `/sign-in?returnUrl=/events/123/players`\n5. Sign in again → should redirect back to `/events/123/players`\n6. `pnpm --filter web test`\nEOF\n\\)\")",
			"Bash(gh issue create:*)",
			"WebFetch(domain:caprover.com)",
			"WebFetch(domain:github.com)",
			"Bash(git commit:*)",
			"Bash(docker exec bhmc-admin-backend-1 /app/.venv/bin/python -c \"\nimport django.views.debug\nimport os\npath = os.path.join\\(os.path.dirname\\(django.views.debug.__file__\\), ''templates'', ''technical_500.html''\\)\nwith open\\(path\\) as f:\n    lines = f.readlines\\(\\)\n    # Print lines around 379\n    for i in range\\(375, 385\\):\n        print\\(f''{i+1}: {lines[i].rstrip\\(\\)}''\\)\n\")",
			"Bash(docker exec bhmc-admin-backend-1 /app/.venv/bin/python -c \"\nimport django.views.debug\nimport os\npath = os.path.join\\(os.path.dirname\\(django.views.debug.__file__\\), ''templates'', ''technical_500.html''\\)\nwith open\\(path\\) as f:\n    lines = f.readlines\\(\\)\n    # Print lines around 370-390 to see the full context\n    for i in range\\(365, 395\\):\n        print\\(f''{i+1}: {lines[i].rstrip\\(\\)}''\\)\n\")",
			"Bash(docker exec:*)",
			"WebSearch",
			"WebFetch(domain:docs.docker.com)",
			"Bash(lsof:*)",
			"Bash(pgrep:*)"
		]
	},
	"hooks": {
		"PreToolUse": [
			{
				"matcher": "Bash",
				"hooks": [
					{
						"type": "command",
						"command": "corepack enable pnpm 2>/dev/null || true"
					}
				]
			}
		]
	}
}
